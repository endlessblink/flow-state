<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Test Tasks</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; font-family: monospace; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ðŸ§ª Create Test Tasks for Pomo-Flow</h1>

    <div>
        <button onclick="createTestTasks()">Create Test Tasks</button>
        <button onclick="checkTasks()">Check Current Tasks</button>
        <button onclick="clearLogs()">Clear Logs</button>
    </div>

    <div id="logs"></div>

    <script>
        function addLog(message, type = 'info') {
            const logsDiv = document.getElementById('logs');
            const logEntry = document.createElement('div');
            logEntry.className = `log ${type}`;
            logEntry.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            logsDiv.appendChild(logEntry);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        async function checkTasks() {
            addLog('Checking current tasks in Pomo-Flow database...', 'info');

            try {
                // Access the Pomo-Flow application's IndexedDB
                const tasks = await localforage.getItem('tasks');

                if (tasks && Array.isArray(tasks)) {
                    addLog(`Found ${tasks.length} tasks in database:`, 'success');
                    tasks.forEach((task, index) => {
                        addLog(`${index + 1}. "${task.title}" - Status: ${task.status}, Project: ${task.projectId || 'NONE'}`, 'info');
                    });
                } else {
                    addLog('No tasks found in database', 'warning');
                }
            } catch (error) {
                addLog(`Error checking tasks: ${error.message}`, 'error');
            }
        }

        async function createTestTasks() {
            addLog('Creating test tasks for today, this week, and general...', 'info');

            const testTasks = [
                {
                    id: 'test-today-1',
                    title: 'Test Task for Today - High Priority',
                    description: 'This task should appear in Today smart view',
                    status: 'planned',
                    priority: 'high',
                    progress: 0,
                    completedPomodoros: 0,
                    subtasks: [],
                    projectId: null, // Uncategorized
                    parentTaskId: null,
                    isInInbox: true,
                    scheduledDate: new Date().toISOString().split('T')[0], // Today
                    instances: [{
                        id: 'instance-1',
                        scheduledDate: new Date().toISOString().split('T')[0],
                        scheduledTime: '09:00',
                        isCompleted: false
                    }],
                    createdAt: new Date(),
                    updatedAt: new Date(),
                    dependsOn: []
                },
                {
                    id: 'test-week-1',
                    title: 'Test Task for This Week',
                    description: 'This task should appear in This Week smart view',
                    status: 'in_progress',
                    priority: 'medium',
                    progress: 50,
                    completedPomodoros: 2,
                    subtasks: [],
                    projectId: null,
                    parentTaskId: null,
                    isInInbox: true,
                    // Schedule for later this week
                    scheduledDate: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    instances: [{
                        id: 'instance-2',
                        scheduledDate: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        scheduledTime: '14:00',
                        isCompleted: false
                    }],
                    createdAt: new Date(),
                    updatedAt: new Date(),
                    dependsOn: []
                },
                {
                    id: 'test-general-1',
                    title: 'General Test Task - No Schedule',
                    description: 'This task should appear in All Tasks smart view',
                    status: 'planned',
                    priority: 'low',
                    progress: 0,
                    completedPomodoros: 0,
                    subtasks: [],
                    projectId: null,
                    parentTaskId: null,
                    isInInbox: true,
                    // No scheduled date - should appear in "All Tasks"
                    scheduledDate: null,
                    instances: [],
                    createdAt: new Date(),
                    updatedAt: new Date(),
                    dependsOn: []
                },
                {
                    id: 'test-project-1',
                    title: 'Test Task in Project A',
                    description: 'This task is in a specific project',
                    status: 'planned',
                    priority: 'high',
                    progress: 0,
                    completedPomodoros: 0,
                    subtasks: [],
                    projectId: 'project-a', // Specific project
                    parentTaskId: null,
                    isInInbox: false,
                    scheduledDate: new Date().toISOString().split('T')[0],
                    instances: [{
                        id: 'instance-3',
                        scheduledDate: new Date().toISOString().split('T')[0],
                        scheduledTime: '11:00',
                        isCompleted: false
                    }],
                    createdAt: new Date(),
                    updatedAt: new Date(),
                    dependsOn: []
                }
            ];

            try {
                // Load localforage script first
                if (typeof localforage === 'undefined') {
                    const script = document.createElement('script');
                    script.src = 'https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js';
                    script.onload = async () => {
                        await saveTasks(testTasks);
                    };
                    document.head.appendChild(script);
                } else {
                    await saveTasks(testTasks);
                }
            } catch (error) {
                addLog(`Error creating test tasks: ${error.message}`, 'error');
            }
        }

        async function saveTasks(tasks) {
            try {
                // Get existing tasks
                const existingTasks = await localforage.getItem('tasks') || [];

                // Filter out any existing test tasks
                const nonTestTasks = existingTasks.filter(task => !task.id.startsWith('test-'));

                // Add new test tasks
                const allTasks = [...nonTestTasks, ...tasks];

                // Save to database
                await localforage.setItem('tasks', allTasks);

                addLog(`Successfully created ${tasks.length} test tasks`, 'success');
                addLog('Tasks created for:', 'info');
                addLog('- Today smart view (test-today-1)', 'info');
                addLog('- This Week smart view (test-week-1)', 'info');
                addLog('- All Tasks smart view (test-general-1)', 'info');
                addLog('- Project-specific task (test-project-1)', 'info');

                // Verify tasks were saved
                setTimeout(checkTasks, 1000);

            } catch (error) {
                addLog(`Error saving tasks: ${error.message}`, 'error');
            }
        }

        // Initialize localforage
        if (typeof localforage !== 'undefined') {
            localforage.config({
                driver: localforage.INDEXEDDB,
                name: 'pomo-flow-db',
                version: 1.0,
                storeName: 'pomo-flow-store',
                description: 'Pomo-Flow database'
            });
        }

        addLog('Test task creator loaded. Click "Create Test Tasks" to add test data.', 'success');
    </script>

    <!-- Include localforage -->
    <script src="https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js"></script>
</body>
</html>