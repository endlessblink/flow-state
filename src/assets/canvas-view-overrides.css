/* Global Vue Flow theme overrides */
.vue-flow {
    background: var(--app-background-gradient);
    outline: none;
    /* Remove default outline, use custom focus-visible */
    width: 100%;
    height: 100%;
    display: flex;
    flex: 1;
}

/* ====================================================================
   BUG-251 FIX: Force visibility on section nodes

   Vue Flow sets visibility: hidden inline on nodes until they're
   properly dimensioned by the resize observer. For our section nodes
   which have explicit width/height, we can safely force visibility.
   This fixes right-click context menus not working on group nodes.
   ==================================================================== */
.vue-flow__node-sectionNode {
    visibility: visible !important;
}

/* Focus-visible for keyboard accessibility - subtle purple glow only */
.vue-flow:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.3);
}

/* Hide scrollbars completely */
.vue-flow__viewport,
.vue-flow__transformationpane,
.vue-flow__pane,
.vue-flow {
    scrollbar-width: none !important;
    /* Firefox */
    -ms-overflow-style: none !important;
    /* IE/Edge */
}

.vue-flow__viewport::-webkit-scrollbar,
.vue-flow__transformationpane::-webkit-scrollbar,
.vue-flow__pane::-webkit-scrollbar,
.vue-flow::-webkit-scrollbar {
    display: none !important;
    /* Chrome/Safari */
}

/* ====================================================================
   FIX #2: POINTER-EVENTS HIERARCHY FOR CLICKABLE RESIZE HANDLES

   Problem: Section content had pointer-events:auto which blocked resize handles
   Solution: Set section content to pointer-events:none, only enable on header
   ==================================================================== */

/* Z-index layering: sections < edges < tasks, with hover states */
/* TASK-072 FIX: Don't force z-index - let Vue Flow node.style.zIndex control it for nested groups */
.vue-flow__node[id^="section-"],
.vue-flow__node-sectionNode {
    /* z-index is now controlled by node.style.zIndex for proper nested group layering */
    /* Allow section wrapper to be interactive */
    pointer-events: auto !important;
}

/* Section node content should NOT block resize handles at edges */
.vue-flow__node[id^="section-"] .section-node,
.vue-flow__node-sectionNode .section-node {
    pointer-events: none !important;
    /* ✅ KEY FIX: Don't block handles */
    cursor: default;
}

/* Section header DOES allow drag events for moving the section */
.vue-flow__node[id^="section-"] .section-header,
.vue-flow__node-sectionNode .section-header {
    pointer-events: auto !important;
    /* ✅ Enable dragging from header */
    cursor: move !important;
}

/* Allow all interactive elements within header to work */
.vue-flow__node[id^="section-"] .section-header *,
.vue-flow__node-sectionNode .section-header * {
    pointer-events: auto !important;
    /* Buttons, inputs, etc. in header */
}

/* Resize handles MUST be on top and fully interactive when visible */
.vue-flow__node[id^="section-"].selected .vue-flow__resize-control.handle,
.vue-flow__node[id^="section-"].selected .custom-resize-handle,
.vue-flow__node[id^="section-"].vue-flow__node--selected .vue-flow__resize-control.handle,
.vue-flow__node[id^="section-"].vue-flow__node--selected .custom-resize-handle,
.vue-flow__node-sectionNode.selected .vue-flow__resize-control.handle,
.vue-flow__node-sectionNode.selected .custom-resize-handle,
.vue-flow__node-sectionNode.vue-flow__node--selected .vue-flow__resize-control.handle,
.vue-flow__node-sectionNode.vue-flow__node--selected .custom-resize-handle {
    pointer-events: auto !important;
    /* ✅ Handles are clickable when selected */
    z-index: 100 !important;
    /* ✅ Above all content */
    cursor: nwse-resize !important;
}

/* Resize lines should be visible but NOT block handle interaction */
.vue-flow__node[id^="section-"] .vue-flow__resize-control.line,
.vue-flow__node[id^="section-"] .custom-resize-line,
.vue-flow__node-sectionNode .vue-flow__resize-control.line,
.vue-flow__node-sectionNode .custom-resize-line {
    pointer-events: none !important;
    /* ✅ Lines don't interfere */
    z-index: 99 !important;
}

/* Create safe zones around edges for resize handles */
.vue-flow__node[id^="section-"]::before,
.vue-flow__node-sectionNode::before {
    content: '';
    position: absolute;
    top: -var(--space-3);
    left: -var(--space-3);
    right: -var(--space-3);
    bottom: -var(--space-3);
    pointer-events: none !important;
    z-index: 99 !important;
}


/* TASK-141 FIX: Tasks must ALWAYS be above groups (groups use z-index 1-99) */
.vue-flow__node:not([data-id^="section-"]) {
    z-index: 1000 !important;
}

/* Ensure task nodes stay on top during hover */
.vue-flow__node:not([data-id^="section-"]):hover {
    z-index: 1001 !important;
    transform: scale(1.02);
    transition: transform var(--duration-normal) var(--ease-out);
}

.vue-flow__edge-path {
    stroke: var(--border-secondary);
    stroke-width: 2px;
    transition: all var(--duration-normal) var(--ease-out);
    filter: drop-shadow(0 0 4px rgba(148, 163, 184, 0.4));
}

.vue-flow__edge {
    cursor: pointer;
}

.vue-flow__edge:hover .vue-flow__edge-path {
    stroke: var(--brand-primary);
    stroke-width: 3px;
    filter: drop-shadow(0 3px 8px rgba(99, 102, 241, 0.5));
}

.vue-flow__edge.selected .vue-flow__edge-path {
    stroke: var(--accent-primary);
    stroke-width: 3px;
    filter: drop-shadow(0 2px 6px rgba(99, 102, 241, 0.4));
}

/* Edge interaction layer - makes edges easier to click */
.vue-flow__edge-interaction {
    stroke-width: 20px !important;
    stroke: transparent !important;
    cursor: pointer;
}

.vue-flow__controls {
    display: none;
    /* Using custom controls */
}

/* Minimap styling fixes */
.vue-flow__minimap {
    background: var(--glass-border) !important;
    border: 1px solid var(--glass-border-strong) !important;
    border-radius: var(--radius-md) !important;
    backdrop-filter: blur(8px) !important;
    z-index: 1000 !important;
    bottom: var(--space-4) !important;
    right: var(--space-4) !important;
}

.vue-flow__minimap-mask {
    fill: var(--blue-bg-medium) !important;
}

.vue-flow__minimap-node {
    fill: var(--purple-border-active) !important;
    stroke: var(--text-primary) !important;
    stroke-width: 1px !important;
}

/* Eye toggle for hiding/showing done tasks - positioned above left side of mini map */
/* Canvas filters container */
.canvas-filters-container {
    position: absolute;
    top: var(--space-5);
    left: var(--space-5);
    z-index: 1000;
    pointer-events: auto;
}


/* Fix mini map blocking clicks */
.vue-flow__minimap-mask {
    pointer-events: none !important;
}

.vue-flow__minimap {
    pointer-events: none !important;
}


/* Fix cursor behavior - default cursor, only grab when panning */
.vue-flow__pane {
    cursor: default !important;
}

.vue-flow__pane.dragging {
    cursor: grabbing !important;
}

/* Nodes should have pointer cursor on hover */
.vue-flow__node {
    cursor: pointer !important;
    border: none !important;
    outline: none !important;
    pointer-events: auto !important;
    /* DEBUG: Ensure nodes are interactive */
}

.vue-flow__node.dragging {
    cursor: grabbing !important;
}

/* Remove borders from all node states */
.vue-flow__node.selected,
.vue-flow__node:focus,
.vue-flow__node:active,
.vue-flow__node:hover {
    border: none !important;
    outline: none !important;
}

/* Comprehensive border removal - target all possible Vue Flow elements */
.vue-flow__node,
.vue-flow__node *,
.vue-flow__node::before,
.vue-flow__node::after {
    border: none !important;
    outline: none !important;
    box-shadow: none !important;
    text-shadow: none !important;
}

/* Target all node types specifically */
.vue-flow__node-default,
.vue-flow__node-input,
.vue-flow__node-output,
.vue-flow__node-group {
    border: none !important;
    outline: none !important;
    box-shadow: none !important;
    background-color: transparent !important;
}

/* Connection handles - subtle, larger, and easy to grab */
.vue-flow__handle {
    width: 12px !important;
    height: 12px !important;
    background: var(--glass-border-hover) !important;
    border: 2px solid rgba(255, 255, 255, 0.4) !important;
    border-radius: 50% !important;
    cursor: crosshair !important;
    transition: all var(--duration-normal) var(--ease-out) !important;
    z-index: 10 !important;
}

.vue-flow__handle:hover {
    width: 16px !important;
    height: 16px !important;
    background: rgba(255, 255, 255, 0.3) !important;
    border-color: rgba(255, 255, 255, 0.7) !important;
    box-shadow: 0 0 8px rgba(255, 255, 255, 0.4) !important;
}



/* Remove background/container borders */
.vue-flow__background,
.vue-flow__container,
.vue-flow__pane,
.vue-flow__viewport,
.vue-flow__transformationpane {
    border: none !important;
    outline: none !important;
}

/* Nuclear option - remove all borders from Vue Flow elements */
.vue-flow * {
    border: none !important;
    outline: none !important;
    text-decoration: none !important;
}

/* Subtle grid visibility - ensure it stays in background */
.vue-flow__background {
    opacity: 0.4 !important;
    z-index: 0 !important;
}

.vue-flow__background-pattern-dots {
    fill: #e5e7eb !important;
    opacity: 0.3 !important;
}

.vue-flow__background-pattern-lines {
    stroke: #e5e7eb !important;
    stroke-width: 0.5px !important;
    opacity: 0.2 !important;
}

/* Ensure grid stays behind all elements */
.vue-flow__background,
.vue-flow__background * {
    z-index: 0 !important;
    pointer-events: none !important;
}

/* Enhanced Resize Handle Styles */
.vue-flow__resize-control {
    position: absolute;
    z-index: 100 !important;
    /* FIX: Don't block pointer events by default - let child selectors control it */
}

.vue-flow__resize-control.handle {
    width: 20px !important;
    /* Match canvas design - smaller, not oversized */
    height: 20px !important;
    border-radius: var(--radius-sm) !important;
    /* Subtle square for canvas design consistency */
    background-color: var(--brand-primary) !important;
    border: 2px solid white !important;
    /* Thinner border matches canvas aesthetic */
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;
    opacity: 1 !important;
    transition: all var(--duration-normal) var(--ease-out) !important;
    pointer-events: auto !important;
    /* CRITICAL: Always allow interaction on handles */
    cursor: nwse-resize !important;
}

/* Larger clickable area */
.vue-flow__resize-control.handle::before {
    content: '';
    position: absolute;
    top: -var(--space-3);
    left: -var(--space-3);
    right: -var(--space-3);
    bottom: -var(--space-3);
    cursor: nwse-resize !important;
}

/* Hover state - subtle growth matching canvas design */
.vue-flow__resize-control.handle:hover {
    width: 24px !important;
    /* Slight growth from 20px */
    height: 24px !important;
    background-color: var(--accent-primary) !important;
    box-shadow: 0 4px 16px rgba(99, 102, 241, 0.5) !important;
    /* Softer glow */
    transform: scale(1.05) !important;
    /* Subtle scale for feedback */
}

/* BUG-043: Edge lines are now clickable resize handles */
.vue-flow__resize-control.line {
    background-color: transparent !important;
    /* Invisible by default */
    opacity: 1 !important;
    transition: background-color var(--duration-normal) var(--ease-out) !important;
    pointer-events: auto !important;
    /* Make lines clickable for resize */
}

.vue-flow__resize-control.line:hover {
    background-color: var(--brand-primary) !important;
}

/* Ensure resize handles are always visible on sections */
.vue-flow__node[data-id^="section-"] .vue-flow__resize-control.handle,
.vue-flow__node[data-id^="section-"] .vue-flow__resize-control.line {
    opacity: 1 !important;
}

/* Enhanced resize handle interactions */
.vue-flow__resize-control.handle:hover {
    transform: scale(1.2) !important;
    background-color: var(--accent-primary) !important;
    box-shadow: 0 3px 12px rgba(0, 0, 0, 0.4) !important;
    border-color: var(--surface-primary) !important;
}

/* Corner handles take priority over edge handles */
.vue-flow__resize-control.handle.top-left,
.vue-flow__resize-control.handle.top-right,
.vue-flow__resize-control.handle.bottom-left,
.vue-flow__resize-control.handle.bottom-right {
    z-index: 102 !important;
}

/* Edge handles have lower z-index to avoid blocking drag */
.vue-flow__resize-control.handle.top,
.vue-flow__resize-control.handle.bottom,
.vue-flow__resize-control.handle.left,
.vue-flow__resize-control.handle.right {
    z-index: 101 !important;
}

/* Specific cursor styles for each handle position */
.vue-flow__resize-control.handle.top-left,
.vue-flow__resize-control.handle.bottom-right {
    cursor: nwse-resize !important;
}

.vue-flow__resize-control.handle.top-right,
.vue-flow__resize-control.handle.bottom-left {
    cursor: nesw-resize !important;
}

.vue-flow__resize-control.handle.top,
.vue-flow__resize-control.handle.bottom {
    cursor: ns-resize !important;
}

.vue-flow__resize-control.handle.left,
.vue-flow__resize-control.handle.right {
    cursor: ew-resize !important;
}

/* BUG-043: Resize line styles with LARGER hit area for easier grabbing */
.vue-flow__resize-control.line.top,
.vue-flow__resize-control.line.bottom {
    height: 12px !important;
    /* Larger hit area (was 2px) */
    width: 100% !important;
    cursor: ns-resize !important;
}

.vue-flow__resize-control.line.left,
.vue-flow__resize-control.line.right {
    width: 12px !important;
    /* Larger hit area (was 2px) */
    height: 100% !important;
    cursor: ew-resize !important;
}

/* Position lines at edges but keep hit area extending inward */
.vue-flow__resize-control.line.top {
    top: -var(--space-1_5) !important;
}

.vue-flow__resize-control.line.bottom {
    bottom: -var(--space-1_5) !important;
}

.vue-flow__resize-control.line.left {
    left: -var(--space-1_5) !important;
}

.vue-flow__resize-control.line.right {
    right: -var(--space-1_5) !important;
}

/* Active resize state with enhanced feedback */
.vue-flow__node[data-id^="section-"].resizing .vue-flow__resize-control.handle,
.vue-flow__node[data-id^="section-"].resizing .vue-flow__resize-control.line {
    opacity: 1 !important;
    background-color: var(--accent-primary) !important;
}

/* z-index for resizing is now controlled by depth bonus in useCanvasSync.ts */
.vue-flow__node[data-id^="section-"].resizing .section-node {
    box-shadow: 0 8px 32px rgba(99, 102, 241, 0.3) !important;
    border-color: var(--accent-primary) !important;
    border-width: 2px !important;
}

/* Handle fade-in animation */
@keyframes handle-fade-in {
    from {
        opacity: 0;
        transform: scale(0.8);
    }

    to {
        opacity: 1;
        transform: scale(1);
    }
}

/* Custom resize handle class overrides - Fix #4: LARGE SQUARES */
.custom-resize-handle {
    width: 32px !important;
    /* LARGE for easy clicking */
    height: 32px !important;
    border-radius: var(--radius-sm) !important;
    /* SQUARE with slight rounding */
    background-color: var(--brand-primary) !important;
    border: 4px solid white !important;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5) !important;
    transition: all var(--duration-normal) cubic-bezier(0.4, 0, 0.2, 1) !important;
    cursor: nwse-resize !important;
}

/* Add larger clickable area with pseudo-element */
.custom-resize-handle::before {
    content: '';
    position: absolute;
    top: -var(--space-3);
    left: -var(--space-3);
    right: -var(--space-3);
    bottom: -var(--space-3);
    cursor: nwse-resize !important;
}

/* Hover state - make handle more prominent */
.custom-resize-handle:hover {
    width: 40px !important;
    height: 40px !important;
    transform: scale(1) !important;
    background-color: var(--accent-primary) !important;
    border-color: white !important;
    border-width: 4px !important;
    box-shadow: 0 6px 24px rgba(99, 102, 241, 0.7) !important;
}

/* Active/dragging state - maximum visual feedback */
.custom-resize-handle:active,
.vue-flow__node[id^="section-"].resizing .custom-resize-handle,
.vue-flow__node-sectionNode.resizing .custom-resize-handle {
    width: 40px !important;
    height: 40px !important;
    background-color: var(--accent-secondary) !important;
    border-color: white !important;
    border-width: 5px !important;
    box-shadow: 0 8px 32px rgba(99, 102, 241, 0.9) !important;
}

.custom-resize-line {
    background-color: var(--brand-primary) !important;
    opacity: 0 !important;
    /* Hidden by default - only show when selected */
    transition: opacity var(--duration-normal) var(--var(--ease-out)-out), visibility var(--duration-normal) ease !important;
}

/* ====================================================================
   FIX #1: SELECTION-BASED RESIZE HANDLE VISIBILITY

   Problem: Resize handles were always visible on all sections, cluttering UI
   Solution: Show handles only when section is selected or being hovered
   ==================================================================== */

/* DEFAULT: Hide resize handles when section NOT selected */
.vue-flow__node[id^="section-"] .vue-flow__resize-control.handle,
.vue-flow__node[id^="section-"] .vue-flow__resize-control.line,
.vue-flow__node[id^="section-"] .custom-resize-handle,
.vue-flow__node[id^="section-"] .custom-resize-line,
.vue-flow__node-sectionNode .vue-flow__resize-control.handle,
.vue-flow__node-sectionNode .vue-flow__resize-control.line,
.vue-flow__node-sectionNode .custom-resize-handle,
.vue-flow__node-sectionNode .custom-resize-line {
    opacity: 0 !important;
    visibility: hidden !important;
    pointer-events: none !important;
    /* Can't interact when hidden */
    transition: opacity var(--duration-normal) var(--var(--ease-out)-out), visibility var(--duration-normal) ease;
}

/* SELECTED: Show resize handles ONLY when section is selected */
.vue-flow__node[id^="section-"].selected .vue-flow__resize-control.handle,
.vue-flow__node[id^="section-"].selected .vue-flow__resize-control.line,
.vue-flow__node[id^="section-"].selected .custom-resize-handle,
.vue-flow__node[id^="section-"].selected .custom-resize-line,
.vue-flow__node[id^="section-"].vue-flow__node--selected .vue-flow__resize-control.handle,
.vue-flow__node[id^="section-"].vue-flow__node--selected .vue-flow__resize-control.line,
.vue-flow__node[id^="section-"].vue-flow__node--selected .custom-resize-handle,
.vue-flow__node[id^="section-"].vue-flow__node--selected .custom-resize-line,
.vue-flow__node-sectionNode.selected .vue-flow__resize-control.handle,
.vue-flow__node-sectionNode.selected .vue-flow__resize-control.line,
.vue-flow__node-sectionNode.selected .custom-resize-handle,
.vue-flow__node-sectionNode.selected .custom-resize-line,
.vue-flow__node-sectionNode.vue-flow__node--selected .vue-flow__resize-control.handle,
.vue-flow__node-sectionNode.vue-flow__node--selected .vue-flow__resize-control.line,
.vue-flow__node-sectionNode.vue-flow__node--selected .custom-resize-handle,
.vue-flow__node-sectionNode.vue-flow__node--selected .custom-resize-line {
    opacity: 1 !important;
    /* Fully visible when selected */
    visibility: visible !important;
    pointer-events: auto !important;
    /* Interactive when visible */
    z-index: 100 !important;
    /* Above all other content */
    display: block !important;
}

/* HOVER: Show handles faintly on hover for discoverability */
.vue-flow__node[id^="section-"]:not(.selected):not(.vue-flow__node--selected):hover .vue-flow__resize-control.handle,
.vue-flow__node[id^="section-"]:not(.selected):not(.vue-flow__node--selected):hover .custom-resize-handle,
.vue-flow__node-sectionNode:not(.selected):not(.vue-flow__node--selected):hover .vue-flow__resize-control.handle,
.vue-flow__node-sectionNode:not(.selected):not(.vue-flow__node--selected):hover .custom-resize-handle {
    opacity: 0.6 !important;
    /* Increased from 0.4 for better visibility */
    visibility: visible !important;
    pointer-events: auto !important;
    /* Allow interaction on hover */
    transition: opacity var(--duration-normal) var(--var(--ease-out)-out), transform var(--duration-normal) ease !important;
}

.vue-flow__node[id^="section-"]:not(.selected):not(.vue-flow__node--selected):hover .vue-flow__resize-control.line,
.vue-flow__node[id^="section-"]:not(.selected):not(.vue-flow__node--selected):hover .custom-resize-line,
.vue-flow__node-sectionNode:not(.selected):not(.vue-flow__node--selected):hover .vue-flow__resize-control.line,
.vue-flow__node-sectionNode:not(.selected):not(.vue-flow__node--selected):hover .custom-resize-line {
    opacity: 0.3 !important;
    /* Increased from 0.2 for better visibility */
    visibility: visible !important;
}

/* GLASS MORPHISM: Direct hover on handle - Enhanced feedback with glass effect */
.vue-flow__node[id^="section-"] .vue-flow__resize-control.handle:hover,
.vue-flow__node[id^="section-"] .custom-resize-handle:hover,
.vue-flow__node-sectionNode .vue-flow__resize-control.handle:hover,
.vue-flow__node-sectionNode .custom-resize-handle:hover {
    opacity: 1 !important;
    visibility: visible !important;
    pointer-events: auto !important;
    transform: scale(1.3) !important;
    /* Increased from 1.15 for clear feedback */
    background: rgba(99, 102, 241, 0.5) !important;
    /* Translucent purple */
    border: 2px solid rgba(255, 255, 255, 0.8) !important;
    /* Bright white border */
    box-shadow: 0 2px 12px rgba(99, 102, 241, 0.4) !important;
    /* Purple glow */
    backdrop-filter: blur(12px) !important;
    /* Enhanced glass blur */
    -webkit-backdrop-filter: blur(12px) !important;
    /* Safari support */
    transition: all var(--duration-normal) cubic-bezier(0.4, 0, 0.2, 1) !important;
    z-index: 103 !important;
    /* Above everything during hover */
}

/* RESIZING: Ensure full visibility during active resize operation */
.vue-flow__node[id^="section-"].resizing .vue-flow__resize-control.handle,
.vue-flow__node[id^="section-"].resizing .vue-flow__resize-control.line,
.vue-flow__node[id^="section-"].resizing .custom-resize-handle,
.vue-flow__node[id^="section-"].resizing .custom-resize-line,
.vue-flow__node-sectionNode.resizing .vue-flow__resize-control.handle,
.vue-flow__node-sectionNode.resizing .vue-flow__resize-control.line,
.vue-flow__node-sectionNode.resizing .custom-resize-handle,
.vue-flow__node-sectionNode.resizing .custom-resize-line {
    opacity: 1 !important;
    visibility: visible !important;
    pointer-events: auto !important;
    z-index: 100 !important;
}

/* Drag cleanup CSS to prevent ghost lines and artifacts */
.vue-flow__node.is-dragging {
    /* Prevent any visual artifacts during drag */
    transition: none !important;
    animation: none !important;
    /* Ensure clean visual state */
    opacity: 0.8 !important;
    transform: scale(0.98) !important;
    z-index: 1000 !important;
}

/* Hide edges connected to dragging nodes to prevent ghost lines */
.vue-flow__node.is-dragging~.vue-flow__edge,
.vue-flow__node.is-dragging .vue-flow__edge {
    opacity: 0.3 !important;
    transition: opacity var(--duration-normal) var(--ease-out) !important;
}

/* Clean up drag state on all edges during any drag operation */
body.dragging-active .vue-flow__edge {
    opacity: 0.5 !important;
    transition: opacity var(--duration-normal) var(--ease-out) !important;
}

/* Ensure clean connection handles during drag (but not during connections) */
body.dragging-active:not(.connecting-active) .vue-flow__handle {
    transition: none !important;
    opacity: 0.7 !important;
}

/* Keep handles fully visible during connection creation */
body.connecting-active .vue-flow__handle {
    opacity: 1 !important;
    transition: all var(--duration-fast) var(--ease-out) !important;
}

/* Connection line while dragging - make it visible and styled */
.vue-flow__connection-line {
    stroke: var(--brand-primary) !important;
    stroke-width: 3px !important;
    stroke-linecap: round !important;
}

.vue-flow__connection-line path {
    stroke: var(--brand-primary) !important;
    stroke-width: 3px !important;
    animation: connection-pulse 1s infinite !important;
}

@keyframes connection-pulse {

    0%,
    100% {
        opacity: 0.8;
    }

    50% {
        opacity: 1;
    }
}

/* Prevent any background effects during drag */
body.dragging-active .vue-flow__background {
    transition: none !important;
}

/* ====================================================================
   MINIMAL RESIZE HANDLE FIXES (work with library CSS, don't fight it)
   ==================================================================== */

/* Make handles slightly larger and easier to click (20px compromise) */
.vue-flow__node-sectionNode .vue-flow__resize-control.handle {
    width: 20px !important;
    height: 20px !important;
    opacity: 1 !important;
}

/* Fix hover - keep handles visible, just highlight them */
.vue-flow__node-sectionNode .vue-flow__resize-control.handle:hover {
    width: 24px !important;
    height: 24px !important;
    transform: scale(1.1);
    opacity: 1 !important;
}

/* Hide handles when section NOT selected AND NOT hovering */
.vue-flow__node-sectionNode:not(.selected):not(.vue-flow__node--selected):not(:hover) .vue-flow__resize-control.handle:not(:hover) {
    opacity: 0 !important;
    pointer-events: none !important;
    transition: opacity var(--duration-normal) var(--var(--ease-out)-out), visibility var(--duration-normal) ease;
}

/* Show handles when section IS selected */
.vue-flow__node-sectionNode.selected .vue-flow__resize-control.handle,
.vue-flow__node-sectionNode.vue-flow__node--selected .vue-flow__resize-control.handle {
    opacity: 1 !important;
    pointer-events: auto !important;
}

/* Keep lines subtle */
.vue-flow__node-sectionNode .vue-flow__resize-control.line {
    opacity: 0.2 !important;
}

/* Canvas empty state */
.canvas-empty-state {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--space-6);
    padding: 2rem;
    background: var(--color-background);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    z-index: 1000;
    pointer-events: none;
    /* Allow clicks to pass through to Done toggle */
}

/* Re-enable pointer events for interactive children */
.canvas-empty-state button,
.canvas-empty-state a {
    pointer-events: auto;
}

.empty-icon {
    color: var(--color-text-secondary);
    opacity: 0.6;
}

.empty-title {
    font-size: 1.75rem;
    font-weight: 600;
    color: var(--color-text-primary);
    margin: 0;
    text-align: center;
}

.empty-description {
    font-size: var(--text-base);
    color: var(--color-text-secondary);
    margin: 0;
    text-align: center;
    max-width: 400px;
    line-height: 1.5;
}

.add-task-button {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-3) var(--space-6);
    background: var(--color-indigo-bg-subtle);
    border: 1px solid var(--color-indigo-bg-heavy);
    color: var(--color-primary);
    border-radius: 0.5rem;
    font-size: var(--text-sm);
    font-weight: 500;
    cursor: pointer;
    transition: all var(--duration-normal) var(--ease-out);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
}

.add-task-button:hover {
    background: var(--color-indigo-bg-heavy);
    border-color: rgba(99, 102, 241, 0.3);
    color: var(--color-primary);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
}

.add-task-button:active {
    transform: translateY(0);
    box-shadow: 0 2px 8px rgba(99, 102, 241, 0.1);
}

/* Vue Flow fade-in transition - fixes initialization deadlock */
.vue-flow {
    opacity: 0;
    transition: opacity var(--duration-slow) var(--ease-out);
}

.vue-flow.canvas-ready {
    opacity: 1;
}

/*
   SHIFT-DRAG SELECTION SUPPORT
   When Shift is held, disable pointer events on Section/Group AND Task nodes
   so the drag event falls through to the Pane to start the selection box.
   This enables rubber-band selection starting from inside a group.
*/
.shift-selecting .vue-flow__node-sectionNode {
    pointer-events: none !important;
}

/* FIX: Explicitly allow interaction with task nodes during shift-select */
.shift-selecting .vue-flow__node-taskNode {
    pointer-events: auto !important;
    z-index: 2000 !important;
    /* Ensure on top of selection pane */
    cursor: context-menu !important;
    /* Hint that it's clickable */
}