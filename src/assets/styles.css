/* Import design tokens FIRST - provides all CSS custom properties */
@import './design-tokens.css';

/* Signal dark mode preference to browser - helps native controls on some systems */
:root {
  color-scheme: dark;
}

/* Then Tailwind CSS - provides utility classes */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* =========================================================================
   SHARED LAYOUT UTILITIES
   Reusable container patterns to reduce CSS duplication across components.
   Added Jan 2026 as part of container consolidation refactor.
   ========================================================================= */

/**
 * Flexbox scroll container - enables scrolling in nested flex layouts.
 * CRITICAL: min-height: 0 allows flex children to shrink below content size.
 * Without this, nested flex containers cannot scroll properly.
 *
 * Usage: Add .scroll-container to any flex child that needs to scroll.
 * Example: <div class="flex-1 scroll-container">...scrollable content...</div>
 */
.scroll-container {
  flex: 1;
  overflow-y: auto;
  min-height: 0;
}

/* Thin scrollbar for inbox task list (global - Vue scoped styles don't work with ::webkit-scrollbar) */
.inbox-tasks::-webkit-scrollbar {
  width: 6px;
}

.inbox-tasks::-webkit-scrollbar-track {
  background: transparent;
}

.inbox-tasks::-webkit-scrollbar-thumb {
  background: var(--glass-border);
  border-radius: var(--radius-md);
}

/* Horizontal scroll variant */
.scroll-container-x {
  flex: 1;
  overflow-x: auto;
  overflow-y: hidden;
  min-width: 0;
}

/**
 * Content section with border separator.
 * Use for grouped settings, filter sections, or any vertically stacked content.
 * Last child automatically removes bottom border.
 */
.content-section {
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
  border-bottom: 1px solid var(--border-subtle);
  padding-bottom: var(--space-3);
}

.content-section:last-child {
  border-bottom: none;
  padding-bottom: 0;
}

/* =========================================================================
   END SHARED LAYOUT UTILITIES
   ========================================================================= */

/* Global reset */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html,
body {
  font-family: ui-sans-serif, system-ui, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  overflow: visible;
  /* Allow canvas controls to overflow */
  height: 100vh;
  width: 100vw;

  /* PWA Mobile Support - ROAD-004 */
  overscroll-behavior: none; /* Prevent rubber-banding on mobile */
  padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
}

#root {
  width: 100vw;
  height: 100vh;
  overflow: visible;
  /* Allow canvas controls to overflow */
  /* Ensure no borders are applied to root element */
  border: none;
  outline: none;
  box-shadow: none;
}

/* TASK-079: Canvas visibility improvements */
.canvas-contour {
  /* Brighter canvas background for better element visibility */
  background: rgba(45, 50, 60, 0.5) !important;
  border: 1px solid var(--border-medium) !important;
}

/* =========================================================================
   GLOBAL DARK MODE FOR NATIVE FORM ELEMENTS
   These styles ensure native <select>, <input> have dark backgrounds
   in ALL environments (Chromium, WebKitGTK, Firefox)
   ========================================================================= */

/* Force dark styling on ALL native select elements */
select {
  background-color: #1e1e28 !important;
  color: #e0e0e0 !important;
  border: 1px solid var(--border-hover) !important;
  border-radius: var(--radius-md);
}

select:focus {
  outline: none;
  border-color: rgba(34, 211, 238, 0.5) !important;
}

select option {
  background-color: #1e1e28 !important;
  color: #e0e0e0 !important;
  padding: var(--space-2);
}

/* Specific class for filter selects with higher specificity */
.filter-controls select,
.filter-controls .filter-select,
.filter-control select,
.filter-select {
  background-color: #1e1e28 !important;
  color: #e0e0e0 !important;
  border: 1px solid var(--border-hover) !important;
}

/* =========================================================================
   BROWSER OPTIMIZATIONS (ZEN / FIREFOX / TAURI-WEBKIT)
   ========================================================================= */

/* Detect Firefox/Zen via feature query (backdrop-filter fallback) or vendor specific */
/* Firefox has notoriously slow backdrop-filter implementation compared to Chromium */

/* 1. Global Glass Optimization for Firefox */
@-moz-document url-prefix() {

  /* Disable heavy backdrop-filter globally on Firefox/Zen */
  .glass,
  [class*="backdrop-blur"] {
    backdrop-filter: none !important;
    background-color: rgba(30, 30, 35, 0.95) !important;
    /* Solid fallback */
    border: 1px solid var(--glass-border) !important;
  }

  /* Disable smooth scrolling for canvas to prevent jank */
  html,
  body {
    scroll-behavior: auto !important;
  }

  /* Optimize SVG painting */
  svg {
    shape-rendering: optimizeSpeed;
    text-rendering: optimizeSpeed;
  }
}

/* =========================================================================
   TAURI / WEBKITGTK OPTIMIZATIONS (Linux Desktop App)
   ========================================================================= */

/* Tauri WebKitGTK on Linux has limited backdrop-filter support */
/* Detect via .tauri-app class added by JavaScript or feature query fallback */

/* When running in Tauri (class added by app initialization) */
.tauri-app .glass,
.tauri-app [class*="backdrop-blur"] {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  background-color: rgba(25, 25, 30, 0.98) !important;
  border: 1px solid var(--border-medium) !important;
}

/* Fix glass panel backgrounds for Tauri */
.tauri-app .glass-panel,
.tauri-app [class*="glass-bg"] {
  background: rgba(20, 22, 28, 0.95) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

/* Tauri sidebar glass fix */
.tauri-app aside,
.tauri-app nav {
  background: rgba(18, 20, 26, 0.98) !important;
  backdrop-filter: none !important;
}

/* Tauri modal/overlay glass fix */
.tauri-app [role="dialog"],
.tauri-app .modal,
.tauri-app .n-modal {
  background: rgba(22, 24, 30, 0.98) !important;
  backdrop-filter: none !important;
}

/* Tauri dropdown/popover glass fix */
.tauri-app .n-dropdown,
.tauri-app .n-popover,
.tauri-app [class*="dropdown"] {
  background: rgba(20, 22, 28, 0.98) !important;
  backdrop-filter: none !important;
}

/* Additional Tauri fallbacks for glass morphism classes */
.tauri-app .glass-effect,
.tauri-app .glass-surface,
.tauri-app .glass-card,
.tauri-app .glass-overlay,
.tauri-app .glass-container,
.tauri-app .task-glass,
.tauri-app .modal-glass,
.tauri-app .sidebar-glass {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  background-color: rgba(25, 25, 30, 0.98) !important;
  border: 1px solid var(--border-medium) !important;
}

/* Canvas-specific fallbacks */
.tauri-app .canvas-contour {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  background: rgba(30, 32, 40, 0.95) !important;
}

/* Task node fallbacks */
.tauri-app .vue-flow__node {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

/* Vue Flow pane fallbacks */
.tauri-app .vue-flow__pane,
.tauri-app .vue-flow__viewport {
  backdrop-filter: none !important;
}

/* =========================================================================
   TAURI NATIVE FORM ELEMENTS FIX
   WebKitGTK renders native <select>, <input> differently from Chromium.
   CSS variables may not work - use explicit colors.
   ========================================================================= */

/* Native select dropdowns - explicit dark styling for WebKitGTK */
.tauri-app select,
.tauri-app .filter-select {
  background-color: #1a1a24 !important;
  color: #e0e0e0 !important;
  border: 1px solid var(--glass-border-hover) !important;
  -webkit-appearance: menulist !important;
  appearance: menulist !important;
}

.tauri-app select option,
.tauri-app .filter-select option {
  background-color: #1a1a24 !important;
  color: #e0e0e0 !important;
}

/* Native input fields */
.tauri-app input[type="text"],
.tauri-app input[type="email"],
.tauri-app input[type="password"],
.tauri-app input[type="number"],
.tauri-app input[type="search"],
.tauri-app textarea {
  background-color: #1a1a24 !important;
  color: #e0e0e0 !important;
  border: 1px solid var(--glass-border-hover) !important;
}

/* Native checkbox styling */
.tauri-app input[type="checkbox"] {
  accent-color: #22d3ee !important;
}

/* Placeholder text color */
.tauri-app input::placeholder,
.tauri-app textarea::placeholder {
  color: rgba(255, 255, 255, 0.5) !important;
  -webkit-backdrop-filter: none !important;
}

/* Component-specific glass fallbacks */
.tauri-app .task-node-glass,
.tauri-app .command-palette-glass,
.tauri-app .context-menu-glass,
.tauri-app .sidebar-panel-glass {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  background-color: rgba(22, 24, 30, 0.98) !important;
  border: 1px solid var(--border-medium) !important;
}

/* =========================================================================
   COMPREHENSIVE TAURI COMPONENT FALLBACKS
   These override inline backdrop-filter styles in Vue components
   ========================================================================= */

/* Modal and Dialog fallbacks */
.tauri-app .modal-overlay,
.tauri-app .modal-content,
.tauri-app .modal-backdrop,
.tauri-app .dialog-overlay,
.tauri-app .dialog-content,
.tauri-app .base-modal-overlay,
.tauri-app .base-modal-content,
.tauri-app .task-edit-modal,
.tauri-app .settings-modal,
.tauri-app .batch-edit-modal,
.tauri-app .group-modal,
.tauri-app .confirmation-modal,
.tauri-app .welcome-modal,
.tauri-app .quick-task-create-modal,
.tauri-app .sync-alert-modal,
.tauri-app .conflict-resolution-dialog,
.tauri-app .manual-merge-modal {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  background-color: rgba(20, 22, 28, 0.98) !important;
}

/* Sidebar and Navigation fallbacks */
.tauri-app .app-sidebar,
.tauri-app .sidebar-content,
.tauri-app .sidebar-smart-item,
.tauri-app .sidebar-nav,
.tauri-app .task-manager-sidebar,
.tauri-app .category-selector,
.tauri-app .filter-dropdown {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  background-color: rgba(18, 20, 26, 0.98) !important;
}

/* Context Menu fallbacks */
.tauri-app .context-menu,
.tauri-app .task-context-menu,
.tauri-app .canvas-context-menu,
.tauri-app .node-context-menu,
.tauri-app .edge-context-menu,
.tauri-app .context-menu-container,
.tauri-app .context-menu-content {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  background-color: rgba(20, 22, 28, 0.98) !important;
}

/* Command Palette fallbacks */
.tauri-app .command-palette,
.tauri-app .command-palette-overlay,
.tauri-app .command-palette-content,
.tauri-app .search-modal,
.tauri-app .search-modal-content {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  background-color: rgba(20, 22, 28, 0.98) !important;
}

/* Canvas Component fallbacks */
.tauri-app .task-node,
.tauri-app .task-node-content,
.tauri-app .group-node,
.tauri-app .group-node-simple,
.tauri-app .canvas-group,
.tauri-app .section-selector,
.tauri-app .inbox-panel,
.tauri-app .inbox-panel-header,
.tauri-app .inbox-filters,
.tauri-app .inbox-time-filters,
.tauri-app .multi-selection-overlay,
.tauri-app .canvas-empty-state {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  background-color: rgba(25, 27, 35, 0.98) !important;
}

/* Task Card fallbacks (Kanban, Calendar, etc.) */
.tauri-app .task-card,
.tauri-app .task-card-content,
.tauri-app .task-row,
.tauri-app .task-list,
.tauri-app .task-table,
.tauri-app .hierarchical-task-row,
.tauri-app .quick-sort-card,
.tauri-app .kanban-column,
.tauri-app .kanban-swimlane {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  background-color: rgba(28, 30, 38, 0.95) !important;
}

/* Dropdown and Popover fallbacks */
.tauri-app .base-dropdown,
.tauri-app .base-dropdown-content,
.tauri-app .base-popover,
.tauri-app .base-popover-content,
.tauri-app .custom-select,
.tauri-app .custom-select-dropdown,
.tauri-app .emoji-picker,
.tauri-app .emoji-picker-content,
.tauri-app .project-filter-dropdown {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  background: rgba(20, 22, 28, 0.98) !important;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5) !important;
}

/* CustomSelect specific fallbacks - must override Vue scoped styles */
/* Match the reference: subtle borders that blend with dark background */
.tauri-app .select-dropdown {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  background: rgba(30, 32, 40, 0.98) !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
  border: 1px solid var(--glass-border-light) !important;
  overflow: hidden !important;
}

.tauri-app .select-trigger {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  background: rgba(40, 42, 52, 0.9) !important;
  border: 1px solid var(--glass-border-light) !important;
  box-shadow: none !important;
}

.tauri-app .select-trigger:hover {
  background: rgba(45, 47, 58, 0.9) !important;
  border-color: var(--border-subtle) !important;
  box-shadow: none !important;
}

.tauri-app .select-trigger:focus {
  border-color: rgba(78, 205, 196, 0.3) !important;
  box-shadow: none !important;
}

.tauri-app .select-trigger.is-open {
  background: rgba(45, 47, 58, 0.9) !important;
  border-color: rgba(78, 205, 196, 0.3) !important;
  box-shadow: none !important;
}

.tauri-app .select-option {
  background: transparent !important;
  border-color: transparent !important;
}

.tauri-app .select-option:hover,
.tauri-app .select-option.is-focused {
  background: var(--glass-bg-soft) !important;
  border-color: transparent !important;
}

.tauri-app .select-option.is-selected {
  background: var(--brand-primary-bg-subtle) !important;
  border-color: rgba(78, 205, 196, 0.3) !important;
}

.tauri-app .select-option.is-selected:hover {
  background: var(--brand-primary-bg-medium) !important;
}

/* Button and Interactive Element fallbacks */
.tauri-app .base-button-glass,
.tauri-app .base-nav-item,
.tauri-app .view-controls,
.tauri-app .filter-controls,
.tauri-app .multi-select-toggle,
.tauri-app .done-toggle,
.tauri-app .drag-handle {
  /* backdrop-filter: none !important; */
  /* -webkit-backdrop-filter: none !important; */
  /* background: rgba(30, 32, 40, 0.95) !important; */
}

/* Calendar Component fallbacks */
.tauri-app .calendar-day-view,
.tauri-app .calendar-week-view,
.tauri-app .calendar-header,
.tauri-app .calendar-inbox-panel,
.tauri-app .calendar-status-overlays,
.tauri-app .unified-inbox-panel {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  background-color: rgba(22, 24, 30, 0.98) !important;
}

/* Sync and System UI fallbacks */
.tauri-app .sync-status,
.tauri-app .sync-health-dashboard,
.tauri-app .sync-alert-system,
.tauri-app .backup-settings,
.tauri-app .backup-verification,
.tauri-app .sync-integration,
.tauri-app .user-profile,
.tauri-app .auth-status-notice,
.tauri-app .error-boundary {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  background-color: rgba(20, 22, 28, 0.98) !important;
}

/* Base component fallbacks */
.tauri-app .base-card,
.tauri-app .base-modal,
.tauri-app .time-display,
.tauri-app .sort-progress,
.tauri-app .quick-task-create {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  background-color: rgba(22, 24, 30, 0.98) !important;
}

/* Project indicator fallbacks */
.tauri-app .project-emoji-icon,
.tauri-app [class*="project-indicator"] {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

/* WebKitGTK-specific fixes using @supports */
/* Fallback for when backdrop-filter doesn't work properly */
@supports not ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))) {

  .glass,
  [class*="backdrop-blur"],
  .glass-panel {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    background-color: rgba(25, 25, 30, 0.98) !important;
    border: 1px solid var(--border-medium) !important;
  }

  /* Native form elements for WebKitGTK (no backdrop-filter support) */
  select,
  .filter-select {
    background-color: #1a1a24 !important;
    color: #e0e0e0 !important;
    border: 1px solid var(--glass-border-hover) !important;
  }

  select option,
  .filter-select option {
    background-color: #1a1a24 !important;
    color: #e0e0e0 !important;
  }

  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="number"],
  input[type="search"],
  textarea {
    background-color: #1a1a24 !important;
    color: #e0e0e0 !important;
    border: 1px solid var(--glass-border-hover) !important;
  }
}

/* Tauri layout fixes - ensure proper sizing within desktop window */
.tauri-app #app,
.tauri-app #root {
  min-height: 100vh;
  min-width: 100vw;
  overflow: hidden;
}

/* Prevent Tauri horizontal scrollbar issues */
.tauri-app {
  overflow-x: hidden;
}

/* Tauri font rendering optimization */
.tauri-app {
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
  font-feature-settings: "kern" 1, "liga" 1;
}

/* 2. Vue Flow Specific Optimizations */
.vue-flow__renderer {
  will-change: transform;
  /* Hint for compositor */
}

/* When panned/zoomed, reduce painting */
.vue-flow__pane.dragging,
.vue-flow__viewport.dragging {
  pointer-events: none;
  /* Disable hover effects during drag */
}