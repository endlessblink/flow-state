/* Global Vue Flow Overrides to prevent rasterization */

/* 1. The Container/Viewport */
.vue-flow__transformation-pane,
.vue-flow__viewport {
    /* BUG-1216: will-change: auto keeps text crisp and typing responsive.
     * will-change: transform was tried but causes sluggish typing (GPU re-rasterization on keystroke).
     * Zoom smoothness is handled by debounced onMoveEnd in useCanvasOrchestrator. */
    will-change: auto !important;
    backface-visibility: hidden !important;
}

/* 2. The Nodes */
.vue-flow__node {
    /* CRITICAL: Disable "will-change: transform" which Vue Flow adds inline.
     This prevents the browser from pre-rasterizing the node as a texture. */
    will-change: auto !important;

    /* NOTE: Do NOT set transform here - Vue Flow uses transform for positioning!
     * The translateZ(0) trick breaks node dragging. */
    backface-visibility: hidden !important;

    /* BUG-1216: Removed text-rendering: optimizeLegibility — forces expensive kerning
     * calculations on every node. Browser defaults are sufficient for canvas task cards. */

    /* BUG-1216: style containment prevents CSS counter/property leaks between nodes.
     * layout+paint containment removed — interferes with text input inside nodes. */
    contain: style;
}

/* 3. BUG-1116: Disable ALL transitions during drag to prevent lag
 * Vue Flow adds .dragging class to nodes being dragged.
 * CSS transitions on transform cause perceived lag as the node
 * "animates" to cursor position instead of snapping instantly. */
.vue-flow__node.dragging,
.vue-flow__node.dragging *,
.vue-flow__node.is-dragging,
.vue-flow__node.is-dragging *,
.vue-flow__node.selected.dragging,
.vue-flow__node.selected.dragging *,
.vue-flow__node.selected.is-dragging,
.vue-flow__node.selected.is-dragging * {
    transition: none !important;
    /* Also disable any animations */
    animation: none !important;
}

/* 4. BUG-1328: Kill ALL transforms on dragging node's direct child (the task-node/section-node root).
 * Any CSS transform on the inner element conflicts with Vue Flow's transform: translate(x,y)
 * on the wrapper, causing cursor drift. This is the nuclear safety net. */
.vue-flow__node.dragging > *,
.vue-flow__node.is-dragging > * {
    transform: none !important;
}

/* 5. BUG-1328: Kill backdrop-filter on the node wrapper AND viewport during drag.
 * On WebKitGTK (Tauri Linux), backdrop-filter creates compositing layers that introduce
 * subpixel rounding errors in transform: translate(x,y) positioning. Each frame of drag
 * re-rasterizes the compositing layer with slightly different subpixel alignment,
 * causing cumulative cursor drift. */
.vue-flow__node.dragging,
.vue-flow__node.is-dragging {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    /* Prevent compositor from pre-rasterizing — let CPU handle pixel-perfect positioning */
    will-change: auto !important;
}

/* Also kill filters on all descendants during drag */
.vue-flow__node.dragging *,
.vue-flow__node.is-dragging * {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    filter: none !important;
}